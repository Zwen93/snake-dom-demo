<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>canvas-3d-demo</title>
	<style type="text/css"></style>
	<script type="text/javascript">
		function createcanvas(width,height){
			var canvasElement = document.createElement("canvas");
			//var canvasElement = document.createElement('canvas');
			canvasElement.width = width;
			canvasElement.height = height;
			canvasElement.id = "test";
			var context = canvasElement.getContext('2d');
			context.translate(width/2,height/2);
			document.body.appendChild(canvasElement);
		}
		var test = new Rotate(250,1000);
		var index = new Array();
		var param = {
			"x":null,
			"y":null,
			"z":null,
			"a":0,
			"r":null,
			"x0":null,
			"y0":null,
			"angle":Math.PI*3/4,
			"angleSin":null,
			"angleCos":null,
			"asin":null,
			"acos":null,
			"add":null
		};
		function Rotate (r,number){
			//this.index = new Array();
			//this.r = r;
			this.r = r;
			this.number = number;
			this.speedRate = 20;

		}
		Rotate.prototype.random = function(){
			var sigh = [-1,1];
			var sighx = sigh[Math.round(Math.random())];
			return sighx;
		}
		Rotate.prototype.randomX = function() {
			var symbol = this.random();
			return (Math.round(Math.random()*this.r)*symbol);
		};
		Rotate.prototype.randomY = function(x){
			var r = this.r;
			var symbol = this.random();
			var maxy = Math.sqrt(r*r-x*x);
			var y = Math.round(Math.random()*maxy)*symbol;
			return y;
		}
		Rotate.prototype.getZ = function(x,y){
			var symbol = this.random();
			return (Math.sqrt(this.r*this.r-x*x-y*y)*symbol);
		}
		Rotate.prototype.init = function(){
			var number = this.number;
			for(var i =0;i<number;i++){
				var x = this.randomX();
				var y = this.randomY(x);
				var z = this.getZ(x,y);
				index[i] = [x,y,z];
				//console.log(x*x+y*y+z*z);
			}
			//console.log(this.index);
		}
		Rotate.prototype.getNewIndex = function(){
			//var newindex;
			//console.log(index[0]);
			// param.a += param.add;
			// param.asin = Math.sin(param.a);
			// param.acos = Math.cos(param.a);
			for(var i =0;i<index.length;i++){
				// newindex = index[i];
				// param.x = newindex[0];
				// param.y = newindex[1];
				// param.z = newindex[2];
				// param.instance = param.x*param.angleSin+param.y*param.angleCos;
				// param.r = Math.sqrt(param.instance*param.instance+param.z*param.z);
				// param.x0 = (param.x*param.angleCos*param.angleCos) - (param.y*param.angleSin*param.angleCos);
				// param.y0 = (param.y*param.angleSin*param.angleSin) - (param.x*param.angleSin*param.angleCos);
				// var xy2 = param.instance*param.acos-param.z*param.asin;
				// var dx = param.angleSin*xy2+param.x0;
				// var dy = param.angleCos*xy2+param.y0;
				// var dz = param.z*param.acos+param.instance*param.asin;
				// index[i] = [dx,dy,dz];
				var id = index[i];
				var x = id[0];
				var y = id[1];
				var z = id[2];
				var an_sin = Math.sin(param.angle);
				var an_cos = Math.cos(param.angle);
				var sin = Math.sin(param.a);
				var cos = Math.cos(param.a);
				var instance = x*an_sin+y*an_cos;
				var r = Math.sqrt(instance*instance+z*z);
				var x0 = (x*an_cos*an_cos) - (y*an_sin*an_cos);
				var y0 = (y*an_sin*an_sin) - (x*an_sin*an_cos);
				var xy2 = instance*cos-z*sin;
				var dx = an_sin*xy2+x0;
				var dy = an_cos*xy2+y0;
				var dz = z*cos+instance*sin;
				index[i] = [dx,dy,dz];
				//console.log(dx*dx+dy*dy+dz*dz);
			}
			
			//console.log(index[0],param.asin,param.acos,param.angleSin,param.angleCos);
			draw();
			
		}

		var draw = function(){
			var canvas = document.getElementById("test");
			var context = canvas.getContext('2d');
			context.clearRect(-300,-300,600,600);
			context.font = "16px";
			context.fillStyle = "#CCC";
			for(var i = 0;i<index.length;i++){
				var drawindex = index[i];
				//context.fillRect(drawindex[0],drawindex[1],5,5);
				context.fillText(i,drawindex[0],drawindex[1]);
			} 
		}
		Rotate.prototype.start = function(){
			//var p = this.index;
			//this.getNewIndex();
			//var z = x;
			//console.log(p);
			//setTimeout(this.start,160);
			//this.timer = setInterval(this.getNewIndex,1600);
		}





		window.onload = function(){
			createcanvas(600,600);
			
			//test.getNewIndex();
			param.angleSin = Math.sin(param.angle);
			param.angleCos = Math.cos(param.angle);
			param.a = Math.PI/360;
			param.asin = Math.sin(param.a);
			param.acos = Math.cos(param.a);
			test.init();
			//test.getNewIndex();
			setInterval(test.getNewIndex,16);
		};

	</script>
</head>
<body>

</body>
</html>